extends base
include _ratingCard

block append head
  script(src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="")
  link(rel='stylesheet' href='https://unpkg.com/leaflet@1.9.4/dist/leaflet.css' integrity='sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=' crossorigin='')


mixin overviewBox(icon,label,text)
  .overview-box__detail
    svg.overview-box__icon
      use(xlink:href=icon)
    span.overview-box__label=label
    span.overview-box__text=text

mixin userOverview(icon, label, text)
  .overview-box__detail
    img.overview-box__img(src=icon, alt=label)
    span.overview-box__label=label
    span.overview-box__text=text




block content 
  section.section-header
    .header__hero
      .header__hero-overlay &nbsp;
      img.header__hero-img(src=`/img/tours/${tour.imageCover}`, alt='Tour 5')

      .heading-box
        h1.heading-primary
          span=tour.name
        .heading-box__group
          .heading-box__detail
            svg.heading-box__icon
              use(xlink:href='/img/icons.svg#icon-clock')
            span.heading-box__text #{tour.duration} days
          .heading-box__detail
            svg.heading-box__icon
              use(xlink:href='/img/icons.svg#icon-map-pin')
            span.heading-box__text #{tour.startLocation.address}
  //icon, label text
  section.section-description
    .overview-box
      div
        .overview-box__group
          h2.heading-secondary.ma-bt-lg Quick facts
          +overviewBox('/img/icons.svg#icon-calendar','Next date',tour.startDates[0].toLocaleDateString())
          +overviewBox('/img/icons.svg#icon-trending-up','Difficulty',tour.difficulty)
          +overviewBox('/img/icons.svg#icon-user','Participants',`${tour.maxGroupSize} people`)
          +overviewBox('/img/icons.svg#icon-star','Rating',`${tour.ratingsAverage} / 5`)

        .overview-box__group
          h2.heading-secondary.ma-bt-lg Your tour guides
          each user in tour.guides 
            +userOverview(`/img/users/${user.photo}`,user.role,user.name)


    .description-box
      h2.heading-secondary.ma-bt-lg About the #{tour.name}
      -const description = tour.description.split('\n');
      p.description__text=description[0]
      p.description__text=description[1]

  section.section-pictures
    each pic,idx in tour.images 
      .picture-box
        img.picture-box__img(src=`/img/tours/${pic}`, alt=`${tour.name}-${idx+1}` class=`picture-box__img--${idx}`)


  section.section-map
    //this is the map section where stuffs will be injected from javascript 
    #map(data-location = `${JSON.stringify(tour.locations)}`)

  section.section-reviews
    .reviews
      each review in tour.reviews 
        +ratingCard(review)


  section.section-cta
    .cta
      .cta__img.cta__img--logo
        img(src='/img/logo-white.png', alt='Natours logo')
      img.cta__img.cta__img--1(src='/img/tours/tour-5-2.jpg', alt='')
      img.cta__img.cta__img--2(src='/img/tours/tour-5-1.jpg', alt='')
      .cta__content
        h2.heading-secondary What are you waiting for?
        p.cta__text 10 days. 1 adventure. Infinite memories. Make it yours today!

        if(user)
          button.btn.btn--green.span-all-rows.bookTour(data-tourId=tour._id) Book tour now!
        else
          button.btn.btn--green.span-all-rows Login to Book tour now!